
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>ashcoder.io - HttpClient to Consume API</title>
        <meta name="description" content="Welcome!" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="ashcoder.io" href="/notes/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="ashcoder.io" href="/notes/feed.atom" />
        <link rel="shortcut icon" href="/notes/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/notes/favicon.ico" type="image/x-icon">

        <link href="/notes/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/notes/assets/css/highlight.css" rel="stylesheet">
        <link href="/notes/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/notes/assets/css/master.css" rel="stylesheet" />
        <link href="/notes/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/notes/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="ashcoder.io" />
        <meta name="msapplication-tooltip" content="ashcoder.io" />
        <meta name="msapplication-starturl" content="/notes/" />

        <meta property="og:title" content="ashcoder.io - HttpClient to Consume API" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://host.com/notes/posts/httpclient" />
        <!-- TODO: More social graph meta tags -->

        <script src="/notes/assets/js/jquery.min.js"></script>
        <script src="/notes/assets/js/bootstrap.min.js"></script>     
        <script src="/notes/assets/js/highlight.pack.js"></script>   
        <script src="/notes/assets/js/clean-blog.js"></script>
        <script src="/notes/assets/js/d3.v3.min.js"></script>
        <script src="/notes/assets/js/trianglify.min.js"></script>
        <script src="/notes/assets/js/Please-compressed.js"></script>
        <script src="/notes/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/notes/assets/js/html5shiv.js"></script>
                <script src="/notes/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/notes/">ashcoder.io</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/notes/posts">Archive</a></li>
        <li><a href="/notes/tags">Tags</a></li>
        <li><a href="/notes/about">About Me</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>HttpClient to Consume API</h1>
    <div class="meta">        
Published on Thursday, June 13, 2019<br>    </div>
        <div class="tags">
                    <a role="button" href="/notes/tags/Aspnet" class="btn btn-default btn-xs">Asp.net</a>
                    <a role="button" href="/notes/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/notes/tags/httpClient" class="btn btn-default btn-xs">httpClient</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h1 id="httpclient-to-comsume-api">HttpClient to Comsume API</h1>
<h1 id="httpclient">HttpClient</h1>
<p>Provides a base class for sending HTTP requests and receiving HTTP responses</p>
<pre><code class="language-csharp">// HttpClient is intended to be instantiated once per application, rather than per-use. See Remarks.
static readonly HttpClient client = new HttpClient();
 
static async Task Main()
{
  // Call asynchronous network methods in a try/catch block to handle exceptions
  try	
  {
     HttpResponseMessage response = await client.GetAsync(&quot;http://www.contoso.com/&quot;);
     response.EnsureSuccessStatusCode();
     string responseBody = await response.Content.ReadAsStringAsync();
     // Above three lines can be replaced with new helper method below
     // string responseBody = await client.GetStringAsync(uri);

     Console.WriteLine(responseBody);
  }  
  catch(HttpRequestException e)
  {
     Console.WriteLine(&quot;\nException Caught!&quot;);	
     Console.WriteLine(&quot;Message :{0} &quot;,e.Message);
  }
}
</code></pre>
<h2 id="webrequest">WebRequest</h2>
<p>Makes a request to a Uniform Resource Identifier (URI). This is an abstract class.</p>
<p>Because the WebRequest class is an abstract class, the actual behavior of WebRequest instances at run time is determined by the descendant class (such as HttpWebRequest and FileWebRequest) returned by Create method.</p>
<pre><code class="language-csharp">            WebRequest request = WebRequest.Create (&quot;http://www.google.com&quot;);
            HttpWebResponse response = (HttpWebResponse)request.GetResponse ();
            Stream dataStream = response.GetResponseStream ();
            // Open the stream using a StreamReader for easy access.
            StreamReader reader = new StreamReader (dataStream);
            string responseFromServer = reader.ReadToEnd ();
            Console.WriteLine (responseFromServer);
            reader.Close ();
            dataStream.Close ();
            response.Close ();
</code></pre>
<h2 id="httpwebrequest">HttpWebRequest</h2>
<p>Provides an HTTP-specific implementation of the WebRequest class.</p>
<pre><code class="language-csharp">    HttpWebRequest myReq =
    (HttpWebRequest)WebRequest.Create(&quot;http://www.contoso.com/&quot;);
</code></pre>
<p><em>for new development HttpClient class is recommended</em></p>
<h2 id="httpmessagehandler">HttpMessageHandler</h2>
<p>A base type for HTTP message handlers.</p>
<pre><code class="language-csharp">public abstract class HttpMessageHandler : IDisposable
</code></pre>
<p>There are various HTTP message handles that can be used. These include the following.</p>
<ul>
<li><p>DelegatingHandler - A class used to plug a handler into a handler chain.</p>
</li>
<li><p>HttpMessageHandler - A simple class to derive from that supports the most common requirements for most applications.</p>
</li>
<li><p>HttpClientHandler - A class that operates at the bottom of the handler chain that actually handles the HTTP transport operations.</p>
</li>
<li><p>WebRequestHandler - A specialty class that operates at the bottom of the handler chain class that handles HTTP transport operations with options that are specific to the System.Net.HttpWebRequest object.</p>
</li>
</ul>
<h2 id="httpclienthandler">HttpClientHandler</h2>
<p>The default message handler used by HttpClient in .NET Framework and .NET Core 2.0 and earlier.</p>
<pre><code class="language-csharp">public class HttpClientHandler : System.Net.Http.HttpMessageHandler
</code></pre>
<pre><code class="language-csharp">static async Task Main()
{
   // Create an HttpClientHandler object and set to use default credentials
   HttpClientHandler handler = new HttpClientHandler();
   handler.UseDefaultCredentials = true;

   // Create an HttpClient object
   HttpClient client = new HttpClient(handler);

   // Call asynchronous network methods in a try/catch block to handle exceptions
   try	
   {
      HttpResponseMessage response = await client.GetAsync(&quot;http://www.contoso.com/&quot;);

      response.EnsureSuccessStatusCode();

      string responseBody = await response.Content.ReadAsStringAsync();
      Console.WriteLine(responseBody);
   }  
   catch(HttpRequestException e)
   {
       Console.WriteLine(&quot;\nException Caught!&quot;);	
       Console.WriteLine(&quot;Message :{0} &quot;,e.Message);
   }

   // Need to call dispose on the HttpClient and HttpClientHandler objects 
   // when done using them, so the app doesn't leak resources
   handler.Dispose(true);
   client.Dispose(true);
}
</code></pre>
<p><strong>HttpClientHandler in .NET Core</strong></p>
<p>Starting with .NET Core 2.1, the System.Net.Http.SocketsHttpHandler class instead of HttpClientHandler provides the implementation used by higher-level HTTP networking APIs.</p>
<h2 id="webrequesthandler">WebRequestHandler</h2>
<p>Provides desktop-specific features not available to Windows Store apps or other environments.</p>
<pre><code>public class WebRequestHandler : System.Net.Http.HttpClientHandler
</code></pre>
<h2 id="delegating-handler">Delegating handler</h2>
<p>A message handler is a class that receives an HTTP request and returns an HTTP response. Message handlers derive from the abstract HttpMessageHandler class.</p>
<p>Typically, a series of message handlers are chained together. The first handler receives an HTTP request, does some processing, and gives the request to the next handler. At some point, the response is created and goes back up the chain. This pattern is called a delegating handler.</p>
<p><img src="images/image1.png" class="img-fluid" alt="delegating handler" /></p>
<p><strong>Server-Side Message Handlers in Web API</strong></p>
<p>On the server side, the Web API pipeline uses some built-in message handlers:</p>
<ul>
<li>HttpServer gets the request from the host.</li>
<li>HttpRoutingDispatcher dispatches the request based on the route.</li>
<li>HttpControllerDispatcher sends the request to a Web API controller.</li>
</ul>
<p><img src="images/image2.png" class="img-fluid" alt="delegating handler" /></p>
<p><strong>Client-Side Message Handlers</strong></p>
<p>On the client side, the HttpClient class uses a message handler to process requests. The default handler is HttpClientHandler, which sends the request over the network and gets the response from the server. You can insert custom message handlers into the client pipeline:</p>
<p><img src="images/image3.png" class="img-fluid" alt="delegating handler" /></p>
<p><strong>Custom Message Handlers</strong>
To write a custom message handler, derive from System.Net.Http.DelegatingHandler and override the SendAsync method. Here is the method signature:</p>
<pre><code class="language-csharp">Task&lt;HttpResponseMessage&gt; SendAsync(
    HttpRequestMessage request, CancellationToken cancellationToken);
</code></pre>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'shadowkiller69x'; // required: replace example with your forum shortname
    var disqus_identifier = 'httpclient';
    var disqus_title = 'HttpClient to Consume API';
    var disqus_url = 'http://host.com/notes/posts/httpclient';

    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://shadowkiller69x.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © 2020
                        <br />
                            <a href="/notes/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/notes/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                       
                    </p>
                </div>
        </div>
</div>

                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

