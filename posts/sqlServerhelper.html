
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>ashcoder.io - Sql Server Important Query</title>
        <meta name="description" content="Welcome!" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="ashcoder.io" href="/notes/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="ashcoder.io" href="/notes/feed.atom" />
        <link rel="shortcut icon" href="/notes/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/notes/favicon.ico" type="image/x-icon">

        <link href="/notes/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/notes/assets/css/highlight.css" rel="stylesheet">
        <link href="/notes/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/notes/assets/css/master.css" rel="stylesheet" />
        <link href="/notes/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/notes/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="ashcoder.io" />
        <meta name="msapplication-tooltip" content="ashcoder.io" />
        <meta name="msapplication-starturl" content="/notes/" />

        <meta property="og:title" content="ashcoder.io - Sql Server Important Query" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://host.com/notes/posts/sqlServerhelper" />
        <!-- TODO: More social graph meta tags -->

        <script src="/notes/assets/js/jquery.min.js"></script>
        <script src="/notes/assets/js/bootstrap.min.js"></script>     
        <script src="/notes/assets/js/highlight.pack.js"></script>   
        <script src="/notes/assets/js/clean-blog.js"></script>
        <script src="/notes/assets/js/d3.v3.min.js"></script>
        <script src="/notes/assets/js/trianglify.min.js"></script>
        <script src="/notes/assets/js/Please-compressed.js"></script>
        <script src="/notes/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/notes/assets/js/html5shiv.js"></script>
                <script src="/notes/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/notes/">ashcoder.io</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/notes/posts">Archive</a></li>
        <li><a href="/notes/tags">Tags</a></li>
        <li><a href="/notes/about">About Me</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Sql Server Important Query</h1>
    <div class="meta">        
Published on Saturday, July 20, 2019<br>    </div>
        <div class="tags">
                    <a role="button" href="/notes/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/notes/tags/Introduction" class="btn btn-default btn-xs">Introduction</a>
                    <a role="button" href="/notes/tags/POCO" class="btn btn-default btn-xs">POCO</a>
                    <a role="button" href="/notes/tags/SQL" class="btn btn-default btn-xs">SQL</a>
                    <a role="button" href="/notes/tags/SQL" class="btn btn-default btn-xs">SQL</a>
                    <a role="button" href="/notes/tags/SQL-Server" class="btn btn-default btn-xs">SQL Server</a>
                    <a role="button" href="/notes/tags/sqlcmd" class="btn btn-default btn-xs">sqlcmd</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h1 id="get-all-table-row-count">Get All Table Row Count</h1>
<p><strong>method1:</strong></p>
<pre><code class="language-sql">CREATE TABLE #counts
(
    table_name varchar(255),
    row_count int
)

EXEC sp_MSForEachTable &#64;command1='INSERT #counts (table_name, row_count) SELECT ''?'', COUNT(*) FROM ?'
SELECT table_name, row_count FROM #counts ORDER BY table_name, row_count DESC
DROP TABLE #counts
</code></pre>
<p><strong>method2:</strong></p>
<pre><code class="language-sql">SELECT o.NAME,
  i.rowcnt 
FROM sysindexes AS i
  INNER JOIN sysobjects AS o ON i.id = o.id 
WHERE i.indid &lt; 2  AND OBJECTPROPERTY(o.id, 'IsMSShipped') = 0
ORDER BY o.NAME
</code></pre>
<p><strong>method3:</strong></p>
<pre><code class="language-sql">-- Shows all user tables and row counts for the current database 
-- Remove is_ms_shipped = 0 check to include system objects 
-- i.index_id &lt; 2 indicates clustered index (1) or hash table (0) 
SELECT o.name,
  ddps.row_count 
FROM sys.indexes AS i
  INNER JOIN sys.objects AS o ON i.OBJECT_ID = o.OBJECT_ID
  INNER JOIN sys.dm_db_partition_stats AS ddps ON i.OBJECT_ID = ddps.OBJECT_ID
  AND i.index_id = ddps.index_id 
WHERE i.index_id &lt; 2  AND o.is_ms_shipped = 0 ORDER BY o.NAME 
</code></pre>
<p>Describe Table</p>
<hr />
<pre><code class="language-sql">exec sp_help 'table_name';
</code></pre>
<pre><code class="language-sql">select *
from INFORMATION_SCHEMA.COLUMNS
where TABLE_NAME='Mct_GL'
</code></pre>
<p>Force Database Delete(Database Is in Use)</p>
<hr />
<pre><code class="language-sql">Use master;
ALTER database DatabaseName set offline with ROLLBACK IMMEDIATE;
DROP database DatabaseName;
</code></pre>
<p>Get table constraints</p>
<hr />
<pre><code class="language-sql">Select C.*, (Select definition From sys.default_constraints Where object_id = C.object_id) As dk_definition,
(Select definition From sys.check_constraints Where object_id = C.object_id) As ck_definition,
(Select name From sys.objects Where object_id = D.referenced_object_id) As fk_table,
(Select name From sys.columns Where column_id = D.parent_column_id And object_id = D.parent_object_id) As fk_col
From sys.objects As C
Left Join (Select * From sys.foreign_key_columns) As D On D.constraint_object_id = C.object_id 
Where C.parent_object_id = (Select object_id From sys.objects Where type = 'U'
And name = 'Table Name Here');
</code></pre>
<h1 id="database-size-estimation">Database Size estimation</h1>
<pre><code>  SELECT 
    t.NAME AS TableName,
    s.Name AS SchemaName,
    p.rows,
    SUM(a.total_pages) * 8 AS TotalSpaceKB, 
    CAST(ROUND(((SUM(a.total_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS TotalSpaceMB,
    SUM(a.used_pages) * 8 AS UsedSpaceKB, 
    CAST(ROUND(((SUM(a.used_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS UsedSpaceMB, 
    (SUM(a.total_pages) - SUM(a.used_pages)) * 8 AS UnusedSpaceKB,
    CAST(ROUND(((SUM(a.total_pages) - SUM(a.used_pages)) * 8) / 1024.00, 2) AS NUMERIC(36, 2)) AS UnusedSpaceMB
FROM 
    sys.tables t
INNER JOIN      
    sys.indexes i ON t.OBJECT_ID = i.object_id
INNER JOIN 
    sys.partitions p ON i.object_id = p.OBJECT_ID AND i.index_id = p.index_id
INNER JOIN 
    sys.allocation_units a ON p.partition_id = a.container_id
LEFT OUTER JOIN 
    sys.schemas s ON t.schema_id = s.schema_id
WHERE 
    t.NAME NOT LIKE 'dt%' 
    AND t.is_ms_shipped = 0
    AND i.OBJECT_ID &gt; 255 
GROUP BY 
    t.Name, s.Name, p.Rows
ORDER BY 
    TotalSpaceMB DESC, t.Name
</code></pre>
<h1 id="sqlcmd-utility">sqlcmd Utility</h1>
<p>Download and Install appropriate version of sqlcmd.Check the following atricle about sqlcmd utility and latest vesion of download link</p>
<p><a href="https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver15">https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver15</a></p>
<p>Connecting and Running Script using sqlcmd</p>
<hr />
<p>Example:</p>
<pre><code class="language-sql">sqlcmd -S.\SQLEXPRESS14 -i e:\ASH\test\posinventoryfullscript.sql -o e:\ASH\test\posoutput.txt
</code></pre>
<h1 id="generate-class-from-database-table">Generate class from database table</h1>
<pre><code class="language-sql">declare &#64;TableName sysname = 'Division'
declare &#64;Result varchar(max) = 'public class ' + &#64;TableName + '
{'

select &#64;Result = &#64;Result + '
    public ' + ColumnType + NullableSign + ' ' + ColumnName + ' { get; set; }
'
from
(
    select 
        replace(col.name, ' ', '_') ColumnName,
        column_id ColumnId,
        case typ.name 
            when 'bigint' then 'long'
            when 'binary' then 'byte[]'
            when 'bit' then 'bool'
            when 'char' then 'string'
            when 'date' then 'DateTime'
            when 'datetime' then 'DateTime'
            when 'datetime2' then 'DateTime'
            when 'datetimeoffset' then 'DateTimeOffset'
            when 'decimal' then 'decimal'
            when 'float' then 'double'
            when 'image' then 'byte[]'
            when 'int' then 'int'
            when 'money' then 'decimal'
            when 'nchar' then 'string'
            when 'ntext' then 'string'
            when 'numeric' then 'decimal'
            when 'nvarchar' then 'string'
            when 'real' then 'float'
            when 'smalldatetime' then 'DateTime'
            when 'smallint' then 'short'
            when 'smallmoney' then 'decimal'
            when 'text' then 'string'
            when 'time' then 'TimeSpan'
            when 'timestamp' then 'long'
            when 'tinyint' then 'byte'
            when 'uniqueidentifier' then 'Guid'
            when 'varbinary' then 'byte[]'
            when 'varchar' then 'string'
            else 'UNKNOWN_' + typ.name
        end ColumnType,
        case 
            when col.is_nullable = 1 and typ.name in ('bigint', 'bit', 'date', 'datetime', 'datetime2', 'datetimeoffset', 'decimal', 'float', 'int', 'money', 'numeric', 'real', 'smalldatetime', 'smallint', 'smallmoney', 'time', 'tinyint', 'uniqueidentifier') 
            then '?' 
            else '' 
        end NullableSign
    from sys.columns col
        join sys.types typ on
            col.system_type_id = typ.system_type_id AND col.user_type_id = typ.user_type_id
    where object_id = object_id(&#64;TableName)
) t
order by ColumnId

set &#64;Result = &#64;Result  + '
}'

print &#64;Result
</code></pre>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'shadowkiller69x'; // required: replace example with your forum shortname
    var disqus_identifier = 'sqlServerhelper';
    var disqus_title = 'Sql Server Important Query';
    var disqus_url = 'http://host.com/notes/posts/sqlServerhelper';

    
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://shadowkiller69x.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © 2020
                        <br />
                            <a href="/notes/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/notes/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                       
                    </p>
                </div>
        </div>
</div>

                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

